{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="customer-dashboard">
    <h1 class="mb-4">My Groups</h1>

    <!-- Groups list -->
    <div class="groups-container">
        {% if groups %}
        {% for group in groups %}
        <div class="card mb-3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <h3 class="card-title h5">{{ group.name }}</h3>
                    <a href="{{ url_for('customer.group_detail', group_id=group._id) }}"
                        class="btn btn-sm btn-primary">View Details</a>
                </div>

                <p class="card-text text-muted mb-2">
                    <small>Members: {{ group.members|length }}</small>
                </p>
                <p class="card-text mb-2">
                    <span class="badge {{ 'bg-success' if group.active else 'bg-secondary' }}">
                        {{ 'Active Group' if group.active else 'Inactive Group' }}
                    </span>
                    <span class="badge {{ 'bg-warning' if group.active_bill_id else 'bg-success' }}">
                        {{ 'Has active bill' if group.active_bill_id else 'No active bill' }}
                    </span>
                </p>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="alert alert-info text-center mt-5" role="alert">
            <p class="mb-0">You haven't joined any groups yet. Create or join a group to get started!</p>
        </div>
        {% endif %}
    </div>

    <!-- Action buttons with Bootstrap -->
    <div class="d-grid gap-2 mb-4">
        <a href="{{ url_for('customer.create_group') }}" class="btn btn-primary">
            <i class="fa fa-users"></i> Create New Group
        </a>
        <a href="{{ url_for('customer.join_group') }}" class="btn btn-outline-secondary">
            <i class="fa fa-plus"></i> Join Existing Group
        </a>
    </div>

    <h1>My Payment Methods</h1>

    <!-- Payment Methods -->
    <div>
        {% if payment_methods %}
        {% for card in payment_methods %}
        <div class="card mb-3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <h3 class="card-title h5">{{ card.nickname }}</h3>
                    <form method="POST" action="{{ url_for('customer.delete_payment_method', token=card.token) }}"
                        onsubmit="return confirm('Are you sure you want to delete this card?');" class="d-inline">
                        <button type="submit" class="btn btn-danger btn-sm text-white">Delete card</button>
                    </form>
                </div>
                <div class="card-text text-muted mb-2">
                    <small>Card number: {{ "*"*12 }}{{ card.last_four }}</small><br>
                    <small>Name on card: {{ card.cardholder_name }}</small><br>
                    <small>Expiry date: {{ card.expiry_date }}</small><br>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="alert alert-info text-center mt-5" role="alert">
            <p class="mb-0">No saved payment methods.</p>
        </div>
        {% endif %}
        <!-- Action buttons with Bootstrap -->
        <div class="d-grid gap-2 mb-4">
            <a href="{{ url_for('customer.add_payment_method_form') }}" class="btn btn-primary">
                <i class="fa fa-users"></i> Add Payment Method
            </a>
        </div>
    </div>
    {% endblock %}